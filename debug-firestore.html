<!DOCTYPE html>
<html>
<head>
  <title>Firestore Debug</title>
</head>
<body>
  <h1>Firestore Debug - Company Data Check</h1>
  <button onclick="checkFirestore()">Check Firestore Data</button>
  <pre id="output"></pre>

  <script src="config/firebase-config.js"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, getDocs, query, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const app = initializeApp(window.__FIREBASE_CONFIG);
    const db = getFirestore(app);

    window.checkFirestore = async function() {
      const output = document.getElementById('output');
      output.textContent = 'Loading...\n';

      try {
        // Check companies collection
        output.textContent += '\n=== COMPANIES ===\n';
        const companiesSnap = await getDocs(collection(db, 'companies'));
        output.textContent += `Total companies: ${companiesSnap.size}\n`;
        companiesSnap.forEach(doc => {
          output.textContent += `  ID: ${doc.id}, Data: ${JSON.stringify(doc.data(), null, 2)}\n`;
        });

        // Check questions collection (first 5)
        output.textContent += '\n=== QUESTIONS (first 5) ===\n';
        const questionsSnap = await getDocs(query(collection(db, 'questions'), limit(5)));
        output.textContent += `Sample questions: ${questionsSnap.size}\n`;
        questionsSnap.forEach(doc => {
          const data = doc.data();
          output.textContent += `  ID: ${doc.id}, company: "${data.company}", text: "${data.text?.substring(0, 50)}..."\n`;
        });

        // Check users collection (first 5)
        output.textContent += '\n=== USERS (first 5) ===\n';
        const usersSnap = await getDocs(query(collection(db, 'users'), limit(5)));
        output.textContent += `Sample users: ${usersSnap.size}\n`;
        usersSnap.forEach(doc => {
          const data = doc.data();
          output.textContent += `  ID: ${doc.id}, company: "${data.company}", role: "${data.role}", isSuperAdmin: ${data.isSuperAdmin}\n`;
        });

        // Check quiz sessions (first 5)
        output.textContent += '\n=== QUIZ SESSIONS (first 5) ===\n';
        const sessionsSnap = await getDocs(query(collection(db, 'quizSessions'), limit(5)));
        output.textContent += `Sample sessions: ${sessionsSnap.size}\n`;
        sessionsSnap.forEach(doc => {
          const data = doc.data();
          output.textContent += `  ID: ${doc.id}, company: "${data.company}"\n`;
        });

        output.textContent += '\n✅ Done!';
      } catch (error) {
        output.textContent += `\n❌ Error: ${error.message}\n${error.stack}`;
      }
    };
  </script>
</body>
</html>
